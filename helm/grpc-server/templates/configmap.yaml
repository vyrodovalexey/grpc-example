apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "grpc-server.fullname" . }}-config
  labels:
    {{- include "grpc-server.labels" . | nindent 4 }}
data:
  # Server configuration (non-sensitive)
  GRPC_PORT: {{ .Values.server.port | quote }}
  METRICS_PORT: {{ .Values.server.metricsPort | quote }}
  LOG_LEVEL: {{ .Values.server.logLevel | quote }}
  SHUTDOWN_TIMEOUT: {{ .Values.server.shutdownTimeout | quote }}
  ENABLE_REFLECTION: {{ .Values.server.enableReflection | quote }}
  # TLS configuration
  TLS_ENABLED: {{ .Values.tls.enabled | quote }}
  {{- if .Values.tls.enabled }}
  TLS_MODE: {{ .Values.tls.mode | quote }}
  TLS_CLIENT_AUTH: {{ .Values.tls.clientAuth | quote }}
  {{- end }}
  # Vault configuration (non-sensitive)
  VAULT_ENABLED: {{ .Values.vault.enabled | quote }}
  {{- if .Values.vault.enabled }}
  VAULT_ADDR: {{ .Values.vault.addr | quote }}
  VAULT_PKI_PATH: {{ .Values.vault.pkiPath | quote }}
  VAULT_PKI_ROLE: {{ .Values.vault.pkiRole | quote }}
  VAULT_PKI_TTL: {{ .Values.vault.pkiTTL | quote }}
  {{- end }}
  # Auth configuration
  AUTH_MODE: {{ .Values.auth.mode | quote }}
  # OIDC configuration (non-sensitive)
  OIDC_ENABLED: {{ .Values.oidc.enabled | quote }}
  {{- if .Values.oidc.enabled }}
  OIDC_ISSUER_URL: {{ .Values.oidc.issuerURL | quote }}
  OIDC_CLIENT_ID: {{ .Values.oidc.clientID | quote }}
  {{- if .Values.oidc.audience }}
  OIDC_AUDIENCE: {{ .Values.oidc.audience | quote }}
  {{- end }}
  {{- end }}
  # OpenTelemetry configuration
  OTEL_ENABLED: {{ .Values.otel.enabled | quote }}
  {{- if .Values.otel.enabled }}
  OTEL_EXPORTER_OTLP_ENDPOINT: {{ .Values.otel.endpoint | quote }}
  OTEL_SERVICE_NAME: {{ default (include "grpc-server.fullname" .) .Values.otel.serviceName | quote }}
  {{- end }}
